<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–∑–∏–Ω–∞ - SweetShoes</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<header class="pink-header">
    <div class="container">
        <div class="logo">
            <i class="fas fa-shoe-prints"></i>
            <h1>SweetShoes</h1>
        </div>
        <nav>
            <a href="/"><i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/catalog.html"><i class="fas fa-store"></i> –ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="/cart.html" class="active"><i class="fas fa-shopping-cart"></i> –ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="/login.html"><i class="fas fa-user"></i> –í–æ–π—Ç–∏</a>
        </nav>
    </div>
</header>

<main class="cart-container container">
    <h2 style="color: var(--pink-dark); margin-bottom: 30px;">
        <i class="fas fa-shopping-cart"></i> –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞
    </h2>

    <div id="cart-items">
        <!-- –¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
        <div class="cart-item">
            <div style="font-size: 30px; color: var(--pink);">
                <i class="fas fa-shoe-prints"></i>
            </div>
            <div style="flex: 1;">
                <h3>–ü—Ä–∏–º–µ—Ä —Ç–æ–≤–∞—Ä–∞</h3>
                <p>–†–∞–∑–º–µ—Ä: 38 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 1</p>
            </div>
            <div style="font-weight: bold; color: var(--pink);">
                2 999 ‚ÇΩ
            </div>
            <button style="background: none; border: none; color: var(--pink-dark); cursor: pointer;">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>

    <div class="cart-total">
        –ò—Ç–æ–≥–æ: <span id="total-price">0</span> ‚ÇΩ
    </div>

    <div style="text-align: center; margin-top: 30px;">
        <button class="btn-pink" style="font-size: 18px; padding: 15px 40px;">
            <i class="fas fa-check"></i> –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
        </button>
    </div>
</main>

<footer class="pink-footer">
    <div class="container">
        <p class="copyright">¬© 2024 SweetShoes. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã üíñ</p>
    </div>
</footer>
<!-- –í –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ cart.html –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º </body> –¥–æ–±–∞–≤—å—Ç–µ: -->
<script>
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', async function() {
        const sessionId = localStorage.getItem('sessionId');

        if (sessionId) {
            try {
                const response = await fetch(`/api/cart/session/${sessionId}`);
                if (response.ok) {
                    const cartData = await response.json();
                    displayCartItems(cartData.items);
                    calculateTotal(cartData.items);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã:', error);
            }
        } else {
            document.getElementById('cart-items').innerHTML =
                '<p style="text-align: center; color: var(--pink); padding: 40px;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>';
        }
    });

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
    function displayCartItems(items) {
        const container = document.getElementById('cart-items');

        if (!items || items.length === 0) {
            container.innerHTML =
                '<p style="text-align: center; color: var(--pink); padding: 40px;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>';
            return;
        }

        container.innerHTML = '';

        items.forEach(item => {
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            cartItem.innerHTML = `
                <div style="font-size: 30px; color: var(--pink);">
                    <i class="fas fa-shoe-prints"></i>
                </div>
                <div style="flex: 1;">
                    <h3>${item.product.name}</h3>
                    <p>–†–∞–∑–º–µ—Ä: ${item.size.size} | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${item.quantity}</p>
                    <p><small>${item.product.brand || ''} ${item.product.category || ''}</small></p>
                </div>
                <div style="font-weight: bold; color: var(--pink);">
                    ${(item.product.price * item.quantity).toFixed(2)} ‚ÇΩ
                </div>
                <button onclick="removeFromCart(${item.id})"
                        style="background: none; border: none; color: var(--pink-dark); cursor: pointer; padding: 10px;">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(cartItem);
        });
    }

    // –†–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã
    function calculateTotal(items) {
        if (!items || items.length === 0) {
            document.getElementById('total-price').textContent = '0';
            return;
        }

        const total = items.reduce((sum, item) => {
            return sum + (item.product.price * item.quantity);
        }, 0);

        document.getElementById('total-price').textContent = total.toFixed(2);
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
    async function removeFromCart(itemId) {
        if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?')) {
            try {
                const response = await fetch(`/api/cart/item/${itemId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã');
                    location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞');
            }
        }
    }

    // –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
    document.querySelector('.btn-pink').addEventListener('click', function() {
        const user = JSON.parse(localStorage.getItem('user'));

        if (!user) {
            if (confirm('–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞?')) {
                window.location.href = '/login.html';
            }
            return;
        }

        const shippingAddress = prompt('–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:');
        if (!shippingAddress) return;

        const paymentMethod = prompt('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (–Ω–∞–ª–∏—á–Ω—ã–µ/–∫–∞—Ä—Ç–∞):', '–Ω–∞–ª–∏—á–Ω—ã–µ');

        fetch('/api/orders', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                userId: user.id,
                shippingAddress: shippingAddress,
                paymentMethod: paymentMethod
            })
        })
        .then(response => response.json())
        .then(order => {
            alert(`–ó–∞–∫–∞–∑ ‚Ññ${order.id} –æ—Ñ–æ—Ä–º–ª–µ–Ω! –°—É–º–º–∞: ${order.totalAmount} ‚ÇΩ`);
            window.location.href = '/';
        })
        .catch(error => {
            alert('–û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞: ' + error.message);
        });
    });
</script>
</body>
</html>